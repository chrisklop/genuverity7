<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GenuVerity - Experimental Visualizations</title>

    <!-- Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>

    <style>
        :root {
            --bg-primary: #050a14;
            --bg-card: #0a1225;
            --text-primary: #e4e4e7;
            --text-secondary: #a1a1aa;
            --text-muted: #71717a;
            --accent-blue: #3b82f6;
            --accent-cyan: #06b6d4;
            --accent-red: #ef4444;
            --accent-amber: #f59e0b;
            --accent-green: #10b981;
            --border-color: rgba(255,255,255,0.08);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
        }

        .header {
            padding: 40px;
            text-align: center;
            border-bottom: 1px solid var(--border-color);
        }

        .header h1 {
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-cyan));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .header p {
            color: var(--text-secondary);
            max-width: 600px;
            margin: 0 auto;
        }

        .experiment {
            min-height: 100vh;
            padding: 60px 40px;
            border-bottom: 1px solid var(--border-color);
            position: relative;
        }

        .experiment-header {
            max-width: 800px;
            margin: 0 auto 40px;
        }

        .experiment-number {
            font-size: 0.8rem;
            color: var(--accent-cyan);
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 8px;
        }

        .experiment-title {
            font-size: 2rem;
            margin-bottom: 12px;
        }

        .experiment-desc {
            color: var(--text-secondary);
        }

        .experiment-tech {
            display: flex;
            gap: 8px;
            margin-top: 16px;
            flex-wrap: wrap;
        }

        .tech-tag {
            padding: 4px 12px;
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 20px;
            font-size: 0.75rem;
            color: var(--accent-blue);
        }

        .canvas-container {
            width: 100%;
            max-width: 1200px;
            height: 600px;
            margin: 0 auto;
            background: var(--bg-card);
            border-radius: 16px;
            border: 1px solid var(--border-color);
            overflow: hidden;
            position: relative;
        }

        canvas, svg {
            width: 100%;
            height: 100%;
            display: block;
        }

        .controls {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-top: 20px;
        }

        .btn {
            padding: 10px 24px;
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 8px;
            color: var(--text-primary);
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .btn:hover {
            background: rgba(59, 130, 246, 0.2);
            border-color: var(--accent-blue);
        }

        /* Stats overlay */
        .stats-overlay {
            position: absolute;
            top: 20px;
            left: 20px;
            padding: 16px;
            background: rgba(10, 18, 37, 0.9);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            font-size: 0.85rem;
            z-index: 10;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            gap: 24px;
            margin-bottom: 8px;
        }

        .stat-row:last-child {
            margin-bottom: 0;
        }

        .stat-label {
            color: var(--text-muted);
        }

        .stat-value {
            font-weight: 600;
            font-variant-numeric: tabular-nums;
        }

        .stat-value.red { color: var(--accent-red); }
        .stat-value.amber { color: var(--accent-amber); }
        .stat-value.green { color: var(--accent-green); }
        .stat-value.blue { color: var(--accent-blue); }

        /* Trust bars */
        .trust-bar {
            height: 40px;
            background: linear-gradient(90deg, var(--accent-green), var(--accent-amber), var(--accent-red));
            border-radius: 8px;
            position: relative;
            overflow: hidden;
        }

        .trust-indicator {
            position: absolute;
            top: 0;
            right: 0;
            height: 100%;
            background: rgba(0,0,0,0.8);
            transition: width 0.5s ease-out;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Experimental Visualizations</h1>
        <p>Exploring advanced animation techniques for visualizing disinformation patterns, viral spread, and media manipulation.</p>
    </div>

    <!-- ═══════════════════════════════════════════════════════════════
         EXPERIMENT 1: VIRAL SPREAD PARTICLE SYSTEM
         ═══════════════════════════════════════════════════════════════ -->
    <section class="experiment" id="exp1">
        <div class="experiment-header">
            <div class="experiment-number">Experiment 01</div>
            <h2 class="experiment-title">Viral Spread: The Contagion Effect</h2>
            <p class="experiment-desc">
                Watch how a single piece of misinformation spreads exponentially through a network.
                Each particle represents a share, repost, or mention. Red particles are the original
                false claim; orange shows mutations.
            </p>
            <div class="experiment-tech">
                <span class="tech-tag">Canvas 2D</span>
                <span class="tech-tag">Particle System</span>
                <span class="tech-tag">Exponential Growth</span>
            </div>
        </div>

        <div class="canvas-container" id="viralContainer">
            <canvas id="viralCanvas"></canvas>
            <div class="stats-overlay">
                <div class="stat-row">
                    <span class="stat-label">Total Shares</span>
                    <span class="stat-value red" id="totalShares">0</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Reach</span>
                    <span class="stat-value amber" id="reach">0</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Mutations</span>
                    <span class="stat-value blue" id="mutations">0</span>
                </div>
            </div>
        </div>

        <div class="controls">
            <button class="btn" onclick="startViralSpread()">Start Spread</button>
            <button class="btn" onclick="resetViralSpread()">Reset</button>
            <button class="btn" onclick="toggleFactCheck()">Deploy Fact-Check</button>
        </div>
    </section>

    <!-- ═══════════════════════════════════════════════════════════════
         EXPERIMENT 2: NARRATIVE MUTATION TREE
         ═══════════════════════════════════════════════════════════════ -->
    <section class="experiment" id="exp2">
        <div class="experiment-header">
            <div class="experiment-number">Experiment 02</div>
            <h2 class="experiment-title">Narrative Mutation: How Claims Evolve</h2>
            <p class="experiment-desc">
                A single claim mutates as it spreads, becoming more extreme or pivoting to
                related conspiracies. This tree visualization shows how "5G causes COVID"
                branched into dozens of variant claims.
            </p>
            <div class="experiment-tech">
                <span class="tech-tag">D3.js</span>
                <span class="tech-tag">Hierarchical Tree</span>
                <span class="tech-tag">Semantic Analysis</span>
            </div>
        </div>

        <div class="canvas-container" id="treeContainer">
            <svg id="mutationTree"></svg>
        </div>
    </section>

    <!-- ═══════════════════════════════════════════════════════════════
         EXPERIMENT 3: ECHO CHAMBER VISUALIZATION
         ═══════════════════════════════════════════════════════════════ -->
    <section class="experiment" id="exp3">
        <div class="experiment-header">
            <div class="experiment-number">Experiment 03</div>
            <h2 class="experiment-title">Echo Chambers: Trapped Information</h2>
            <p class="experiment-desc">
                Information particles bounce within isolated bubbles, rarely crossing
                into other communities. Watch how narratives become reinforced and
                amplified within closed systems.
            </p>
            <div class="experiment-tech">
                <span class="tech-tag">Canvas 2D</span>
                <span class="tech-tag">Physics Simulation</span>
                <span class="tech-tag">Collision Detection</span>
            </div>
        </div>

        <div class="canvas-container" id="echoContainer">
            <canvas id="echoCanvas"></canvas>
        </div>
    </section>

    <!-- ═══════════════════════════════════════════════════════════════
         EXPERIMENT 4: BOT NETWORK COORDINATION
         ═══════════════════════════════════════════════════════════════ -->
    <section class="experiment" id="exp4">
        <div class="experiment-header">
            <div class="experiment-number">Experiment 04</div>
            <h2 class="experiment-title">Bot Network: Coordinated Inauthentic Behavior</h2>
            <p class="experiment-desc">
                A grid of accounts where bot networks light up in coordinated patterns,
                revealing the artificial amplification of content. Watch for the telltale
                synchronized waves of activity.
            </p>
            <div class="experiment-tech">
                <span class="tech-tag">Canvas Grid</span>
                <span class="tech-tag">Wave Propagation</span>
                <span class="tech-tag">Pattern Detection</span>
            </div>
        </div>

        <div class="canvas-container" id="botContainer">
            <canvas id="botCanvas"></canvas>
            <div class="stats-overlay">
                <div class="stat-row">
                    <span class="stat-label">Active Accounts</span>
                    <span class="stat-value blue" id="activeAccounts">0</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Bot Probability</span>
                    <span class="stat-value amber" id="botProb">0%</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Coordination Score</span>
                    <span class="stat-value red" id="coordScore">0.00</span>
                </div>
            </div>
        </div>

        <div class="controls">
            <button class="btn" onclick="triggerBotWave()">Trigger Coordinated Campaign</button>
            <button class="btn" onclick="showOrganicActivity()">Show Organic Activity</button>
        </div>
    </section>

    <!-- ═══════════════════════════════════════════════════════════════
         EXPERIMENT 5: TRUST EROSION OVER TIME
         ═══════════════════════════════════════════════════════════════ -->
    <section class="experiment" id="exp5">
        <div class="experiment-header">
            <div class="experiment-number">Experiment 05</div>
            <h2 class="experiment-title">Trust Erosion: Death by a Thousand Cuts</h2>
            <p class="experiment-desc">
                Each false claim chips away at institutional trust. This visualization shows
                how repeated exposure to misinformation gradually erodes confidence in
                media, science, and government.
            </p>
            <div class="experiment-tech">
                <span class="tech-tag">GSAP Timeline</span>
                <span class="tech-tag">Degradation Effect</span>
                <span class="tech-tag">Interactive Decay</span>
            </div>
        </div>

        <div class="canvas-container" style="padding: 40px; height: auto; min-height: 500px;">
            <div id="trustErosion">
                <div style="margin-bottom: 30px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span>Trust in Media</span>
                        <span id="mediaTrust">87%</span>
                    </div>
                    <div class="trust-bar">
                        <div class="trust-indicator" id="mediaIndicator" style="width: 13%;"></div>
                    </div>
                </div>
                <div style="margin-bottom: 30px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span>Trust in Science</span>
                        <span id="scienceTrust">92%</span>
                    </div>
                    <div class="trust-bar">
                        <div class="trust-indicator" id="scienceIndicator" style="width: 8%;"></div>
                    </div>
                </div>
                <div style="margin-bottom: 30px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span>Trust in Government</span>
                        <span id="govTrust">45%</span>
                    </div>
                    <div class="trust-bar">
                        <div class="trust-indicator" id="govIndicator" style="width: 55%;"></div>
                    </div>
                </div>
                <div style="margin-bottom: 30px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span>Trust in Elections</span>
                        <span id="electionTrust">72%</span>
                    </div>
                    <div class="trust-bar">
                        <div class="trust-indicator" id="electionIndicator" style="width: 28%;"></div>
                    </div>
                </div>

                <div style="margin-top: 40px; padding: 20px; background: rgba(239, 68, 68, 0.1); border-radius: 12px; border: 1px solid rgba(239, 68, 68, 0.3);">
                    <div style="font-weight: 600; margin-bottom: 8px; color: var(--accent-red);">
                        Disinformation Events
                    </div>
                    <div id="eventLog" style="font-size: 0.85rem; color: var(--text-secondary); max-height: 150px; overflow-y: auto;">
                        <div style="padding: 4px 0; border-bottom: 1px solid var(--border-color);">
                            Click "Inject Disinformation" to simulate false claim exposure
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="controls">
            <button class="btn" onclick="injectDisinfo()">Inject Disinformation</button>
            <button class="btn" onclick="deployFactCheck5()">Deploy Fact-Check</button>
            <button class="btn" onclick="resetTrust()">Reset Trust Levels</button>
        </div>
    </section>

    <!-- ═══════════════════════════════════════════════════════════════
         EXPERIMENT 6: SOURCE LAUNDERING FLOW
         ═══════════════════════════════════════════════════════════════ -->
    <section class="experiment" id="exp6">
        <div class="experiment-header">
            <div class="experiment-number">Experiment 06</div>
            <h2 class="experiment-title">Source Laundering: From Fringe to Mainstream</h2>
            <p class="experiment-desc">
                A flow diagram showing how narratives originating from fringe sources
                get picked up, repackaged, and eventually reported by mainstream outlets
                as "some people say" stories.
            </p>
            <div class="experiment-tech">
                <span class="tech-tag">D3.js</span>
                <span class="tech-tag">Flow Visualization</span>
                <span class="tech-tag">Source Tracking</span>
            </div>
        </div>

        <div class="canvas-container" id="sankeyContainer">
            <svg id="sankeyDiagram"></svg>
        </div>
    </section>

    <!-- ═══════════════════════════════════════════════════════════════
         EXPERIMENT 7: WEB OF LIES - INTERCONNECTED CLAIMS
         ═══════════════════════════════════════════════════════════════ -->
    <section class="experiment" id="exp7">
        <div class="experiment-header">
            <div class="experiment-number">Experiment 07</div>
            <h2 class="experiment-title">Web of Lies: The Conspiracy Ecosystem</h2>
            <p class="experiment-desc">
                An interconnected force-directed graph showing how conspiracy theories
                link together. Pull on one thread and watch how it connects to seemingly
                unrelated narratives.
            </p>
            <div class="experiment-tech">
                <span class="tech-tag">D3.js Force</span>
                <span class="tech-tag">Network Graph</span>
                <span class="tech-tag">Semantic Links</span>
            </div>
        </div>

        <div class="canvas-container" id="webContainer">
            <svg id="webOfLies"></svg>
        </div>
    </section>

    <script>
        // ═══════════════════════════════════════════════════════════════
        // EXPERIMENT 1: VIRAL SPREAD PARTICLE SYSTEM
        // ═══════════════════════════════════════════════════════════════

        const viralCanvas = document.getElementById('viralCanvas');
        const viralCtx = viralCanvas.getContext('2d');
        let viralParticles = [];
        let viralAnimationId = null;
        let factCheckActive = false;

        function resizeCanvas(canvas, container) {
            const rect = container.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = rect.height;
        }

        resizeCanvas(viralCanvas, document.getElementById('viralContainer'));

        class ViralParticle {
            constructor(x, y, generation = 0, isMutation = false) {
                this.x = x;
                this.y = y;
                this.generation = generation;
                this.isMutation = isMutation;
                this.vx = (Math.random() - 0.5) * 4;
                this.vy = (Math.random() - 0.5) * 4;
                this.radius = Math.max(2, 8 - generation * 0.5);
                this.alpha = 1;
                this.spreadTimer = Math.random() * 60 + 30;
                this.hasSpread = false;
                this.factChecked = false;
            }

            update() {
                this.x += this.vx;
                this.y += this.vy;
                this.vx *= 0.99;
                this.vy *= 0.99;

                if (this.x < this.radius || this.x > viralCanvas.width - this.radius) this.vx *= -1;
                if (this.y < this.radius || this.y > viralCanvas.height - this.radius) this.vy *= -1;

                this.spreadTimer--;
                if (this.spreadTimer <= 0 && !this.hasSpread && !this.factChecked && this.generation < 6) {
                    this.spread();
                }

                if (this.factChecked) {
                    this.alpha -= 0.02;
                }
            }

            spread() {
                this.hasSpread = true;
                const numChildren = Math.floor(Math.random() * 3) + 1;
                for (let i = 0; i < numChildren; i++) {
                    const isMutation = Math.random() < 0.15;
                    viralParticles.push(new ViralParticle(
                        this.x + (Math.random() - 0.5) * 30,
                        this.y + (Math.random() - 0.5) * 30,
                        this.generation + 1,
                        isMutation || this.isMutation
                    ));
                }
            }

            draw() {
                viralCtx.beginPath();
                viralCtx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);

                const baseColor = this.isMutation ? '245, 158, 11' : '239, 68, 68';
                const glowIntensity = Math.max(0.2, 1 - this.generation * 0.15);

                viralCtx.shadowBlur = 15 * glowIntensity;
                viralCtx.shadowColor = `rgba(${baseColor}, ${this.alpha * 0.8})`;
                viralCtx.fillStyle = `rgba(${baseColor}, ${this.alpha * glowIntensity})`;
                viralCtx.fill();

                viralCtx.beginPath();
                viralCtx.arc(this.x, this.y, this.radius * 0.6, 0, Math.PI * 2);
                viralCtx.fillStyle = `rgba(255, 255, 255, ${this.alpha * 0.5})`;
                viralCtx.fill();

                viralCtx.shadowBlur = 0;
            }
        }

        function animateViral() {
            viralCtx.fillStyle = 'rgba(10, 18, 37, 0.15)';
            viralCtx.fillRect(0, 0, viralCanvas.width, viralCanvas.height);

            if (factCheckActive) {
                viralParticles.forEach(p => {
                    if (Math.random() < 0.05) p.factChecked = true;
                });
            }

            viralParticles = viralParticles.filter(p => p.alpha > 0);

            viralParticles.forEach(p => {
                p.update();
                p.draw();
            });

            document.getElementById('totalShares').textContent = viralParticles.length.toLocaleString();
            document.getElementById('reach').textContent = (viralParticles.length * 847).toLocaleString();
            document.getElementById('mutations').textContent = viralParticles.filter(p => p.isMutation).length;

            viralAnimationId = requestAnimationFrame(animateViral);
        }

        function startViralSpread() {
            resetViralSpread();
            viralParticles.push(new ViralParticle(viralCanvas.width / 2, viralCanvas.height / 2, 0));
            animateViral();
        }

        function resetViralSpread() {
            cancelAnimationFrame(viralAnimationId);
            viralParticles = [];
            factCheckActive = false;
            viralCtx.fillStyle = 'rgba(10, 18, 37, 1)';
            viralCtx.fillRect(0, 0, viralCanvas.width, viralCanvas.height);
            document.getElementById('totalShares').textContent = '0';
            document.getElementById('reach').textContent = '0';
            document.getElementById('mutations').textContent = '0';
        }

        function toggleFactCheck() {
            factCheckActive = !factCheckActive;
        }

        // ═══════════════════════════════════════════════════════════════
        // EXPERIMENT 2: NARRATIVE MUTATION TREE
        // ═══════════════════════════════════════════════════════════════

        function initMutationTree() {
            const container = document.getElementById('treeContainer');
            const rect = container.getBoundingClientRect();
            const width = rect.width;
            const height = rect.height;

            const svg = d3.select('#mutationTree')
                .attr('width', width)
                .attr('height', height);

            const treeData = {
                name: "5G causes COVID-19",
                children: [
                    {
                        name: "5G weakens immune system",
                        mutation: "causal shift",
                        children: [
                            { name: "5G makes vaccines ineffective", mutation: "addition" },
                            { name: "5G activates dormant viruses", mutation: "escalation" }
                        ]
                    },
                    {
                        name: "COVID is cover for 5G rollout",
                        mutation: "inversion",
                        children: [
                            { name: "Lockdowns enabled secret 5G installation", mutation: "elaboration" },
                            { name: "COVID symptoms = 5G radiation", mutation: "replacement" }
                        ]
                    },
                    {
                        name: "Bill Gates uses 5G for mind control",
                        mutation: "actor addition",
                        children: [
                            { name: "Vaccines contain 5G nanobots", mutation: "tech fantasy" },
                            { name: "5G towers track vaccinated people", mutation: "surveillance" }
                        ]
                    }
                ]
            };

            const g = svg.append('g').attr('transform', `translate(100, ${height / 2})`);

            const tree = d3.tree().size([height - 80, width - 250]);
            const root = d3.hierarchy(treeData);
            tree(root);

            // Links
            g.selectAll('.link')
                .data(root.links())
                .enter()
                .append('path')
                .attr('fill', 'none')
                .attr('stroke', 'rgba(255,255,255,0.2)')
                .attr('stroke-width', 1.5)
                .attr('d', d3.linkHorizontal().x(d => d.y).y(d => d.x));

            // Nodes
            const node = g.selectAll('.node')
                .data(root.descendants())
                .enter()
                .append('g')
                .attr('transform', d => `translate(${d.y}, ${d.x})`);

            node.append('circle')
                .attr('r', 8)
                .attr('fill', '#0a1225')
                .attr('stroke', '#3b82f6')
                .attr('stroke-width', 2);

            node.append('text')
                .attr('dy', -15)
                .attr('x', d => d.children ? -10 : 10)
                .attr('text-anchor', d => d.children ? 'end' : 'start')
                .attr('fill', '#a1a1aa')
                .attr('font-size', '11px')
                .text(d => d.data.name);

            // Mutation badges
            node.filter(d => d.data.mutation)
                .append('text')
                .attr('dy', 22)
                .attr('x', d => d.children ? -10 : 10)
                .attr('text-anchor', d => d.children ? 'end' : 'start')
                .attr('fill', '#f59e0b')
                .attr('font-size', '9px')
                .text(d => `[${d.data.mutation}]`);
        }

        // ═══════════════════════════════════════════════════════════════
        // EXPERIMENT 3: ECHO CHAMBER (Pure Canvas)
        // ═══════════════════════════════════════════════════════════════

        const echoCanvas = document.getElementById('echoCanvas');
        const echoCtx = echoCanvas.getContext('2d');
        let echoParticles = [];

        function initEchoChamber() {
            resizeCanvas(echoCanvas, document.getElementById('echoContainer'));

            const chambers = [
                { x: 200, y: 200, radius: 150, color: 'rgba(239, 68, 68, 0.15)', particles: [] },
                { x: 500, y: 350, radius: 180, color: 'rgba(59, 130, 246, 0.15)', particles: [] },
                { x: 850, y: 200, radius: 140, color: 'rgba(245, 158, 11, 0.15)', particles: [] },
                { x: 700, y: 450, radius: 160, color: 'rgba(6, 182, 212, 0.15)', particles: [] }
            ];

            chambers.forEach(chamber => {
                for (let i = 0; i < 12; i++) {
                    const angle = Math.random() * Math.PI * 2;
                    const dist = Math.random() * chamber.radius * 0.6;
                    chamber.particles.push({
                        x: chamber.x + Math.cos(angle) * dist,
                        y: chamber.y + Math.sin(angle) * dist,
                        vx: (Math.random() - 0.5) * 2,
                        vy: (Math.random() - 0.5) * 2,
                        radius: 3 + Math.random() * 4
                    });
                }
            });

            function animateEcho() {
                echoCtx.fillStyle = 'rgba(10, 18, 37, 0.2)';
                echoCtx.fillRect(0, 0, echoCanvas.width, echoCanvas.height);

                chambers.forEach(chamber => {
                    // Draw chamber
                    echoCtx.beginPath();
                    echoCtx.arc(chamber.x, chamber.y, chamber.radius, 0, Math.PI * 2);
                    echoCtx.fillStyle = chamber.color;
                    echoCtx.fill();
                    echoCtx.strokeStyle = 'rgba(255,255,255,0.1)';
                    echoCtx.stroke();

                    // Update and draw particles
                    chamber.particles.forEach(p => {
                        p.x += p.vx;
                        p.y += p.vy;

                        // Bounce off chamber walls
                        const dx = p.x - chamber.x;
                        const dy = p.y - chamber.y;
                        const dist = Math.sqrt(dx * dx + dy * dy);

                        if (dist > chamber.radius - p.radius) {
                            const nx = dx / dist;
                            const ny = dy / dist;
                            const dot = p.vx * nx + p.vy * ny;
                            p.vx -= 2 * dot * nx;
                            p.vy -= 2 * dot * ny;
                            p.x = chamber.x + nx * (chamber.radius - p.radius - 1);
                            p.y = chamber.y + ny * (chamber.radius - p.radius - 1);
                        }

                        // Draw particle
                        echoCtx.beginPath();
                        echoCtx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
                        echoCtx.fillStyle = 'rgba(255,255,255,0.7)';
                        echoCtx.fill();
                    });

                    // Draw connections
                    chamber.particles.forEach((p1, i) => {
                        chamber.particles.slice(i + 1).forEach(p2 => {
                            const dx = p1.x - p2.x;
                            const dy = p1.y - p2.y;
                            const dist = Math.sqrt(dx * dx + dy * dy);
                            if (dist < 60) {
                                echoCtx.beginPath();
                                echoCtx.moveTo(p1.x, p1.y);
                                echoCtx.lineTo(p2.x, p2.y);
                                echoCtx.strokeStyle = `rgba(255,255,255,${0.3 * (1 - dist / 60)})`;
                                echoCtx.stroke();
                            }
                        });
                    });
                });

                requestAnimationFrame(animateEcho);
            }

            animateEcho();
        }

        // ═══════════════════════════════════════════════════════════════
        // EXPERIMENT 4: BOT NETWORK GRID (Canvas)
        // ═══════════════════════════════════════════════════════════════

        const botCanvas = document.getElementById('botCanvas');
        const botCtx = botCanvas.getContext('2d');
        let botCells = [];
        const gridCols = 50;
        const gridRows = 25;

        function initBotNetwork() {
            resizeCanvas(botCanvas, document.getElementById('botContainer'));

            const cellWidth = botCanvas.width / gridCols;
            const cellHeight = botCanvas.height / gridRows;

            botCells = [];
            for (let row = 0; row < gridRows; row++) {
                for (let col = 0; col < gridCols; col++) {
                    botCells.push({
                        x: col * cellWidth,
                        y: row * cellHeight,
                        width: cellWidth - 1,
                        height: cellHeight - 1,
                        row, col,
                        isBot: Math.random() < 0.25,
                        active: 0
                    });
                }
            }

            function animateBot() {
                botCtx.fillStyle = '#0a1225';
                botCtx.fillRect(0, 0, botCanvas.width, botCanvas.height);

                let activeCount = 0;
                let botActiveCount = 0;

                botCells.forEach(cell => {
                    if (cell.active > 0) {
                        cell.active -= 0.02;
                        activeCount++;
                        if (cell.isBot) botActiveCount++;
                    }

                    let color = '#1a1f35';
                    if (cell.active > 0) {
                        color = cell.isBot ? `rgba(245, 158, 11, ${cell.active})` : `rgba(59, 130, 246, ${cell.active * 0.6})`;
                    }

                    botCtx.fillStyle = color;
                    botCtx.fillRect(cell.x, cell.y, cell.width, cell.height);
                });

                document.getElementById('activeAccounts').textContent = activeCount;
                document.getElementById('botProb').textContent = activeCount > 0 ?
                    Math.round((botActiveCount / activeCount) * 100) + '%' : '0%';
                document.getElementById('coordScore').textContent = (botActiveCount / 10).toFixed(2);

                requestAnimationFrame(animateBot);
            }

            animateBot();
        }

        function triggerBotWave() {
            const startCol = Math.floor(gridCols / 2);
            botCells.forEach(cell => {
                if (cell.isBot) {
                    setTimeout(() => {
                        cell.active = 1;
                    }, Math.abs(cell.col - startCol) * 30 + Math.random() * 50);
                }
            });
        }

        function showOrganicActivity() {
            for (let i = 0; i < 30; i++) {
                const randomCell = botCells[Math.floor(Math.random() * botCells.length)];
                setTimeout(() => {
                    randomCell.active = 0.7 + Math.random() * 0.3;
                }, i * 100 + Math.random() * 200);
            }
        }

        // ═══════════════════════════════════════════════════════════════
        // EXPERIMENT 5: TRUST EROSION
        // ═══════════════════════════════════════════════════════════════

        const trustLevels = { media: 87, science: 92, gov: 45, election: 72 };

        const disinfoEvents = [
            { text: "Viral post claims voting machines were 'hacked'", targets: ['election', 'gov'], damage: [8, 3] },
            { text: "False claim about vaccine side effects spreads", targets: ['science', 'media'], damage: [5, 4] },
            { text: "Doctored video of politician goes viral", targets: ['media', 'gov'], damage: [6, 5] },
            { text: "Conspiracy about 'deep state' trends", targets: ['gov', 'election'], damage: [7, 4] },
            { text: "Fake news site mimics legitimate outlet", targets: ['media'], damage: [8] },
            { text: "AI-generated audio of scientist surfaces", targets: ['science', 'media'], damage: [6, 5] }
        ];

        function injectDisinfo() {
            const event = disinfoEvents[Math.floor(Math.random() * disinfoEvents.length)];
            event.targets.forEach((target, i) => {
                trustLevels[target] = Math.max(10, trustLevels[target] - event.damage[i]);
            });
            updateTrustDisplay();

            const log = document.getElementById('eventLog');
            const entry = document.createElement('div');
            entry.style.cssText = 'padding: 4px 0; border-bottom: 1px solid rgba(255,255,255,0.08);';
            entry.innerHTML = `<span style="color: #ef4444;">▼</span> ${event.text}`;
            log.insertBefore(entry, log.firstChild);
        }

        function deployFactCheck5() {
            Object.keys(trustLevels).forEach(key => {
                trustLevels[key] = Math.min(100, trustLevels[key] + 3);
            });
            updateTrustDisplay();

            const log = document.getElementById('eventLog');
            const entry = document.createElement('div');
            entry.style.cssText = 'padding: 4px 0; border-bottom: 1px solid rgba(255,255,255,0.08);';
            entry.innerHTML = `<span style="color: #10b981;">▲</span> Fact-check deployed - trust partially restored`;
            log.insertBefore(entry, log.firstChild);
        }

        function updateTrustDisplay() {
            document.getElementById('mediaTrust').textContent = trustLevels.media + '%';
            document.getElementById('scienceTrust').textContent = trustLevels.science + '%';
            document.getElementById('govTrust').textContent = trustLevels.gov + '%';
            document.getElementById('electionTrust').textContent = trustLevels.election + '%';

            gsap.to('#mediaIndicator', { width: (100 - trustLevels.media) + '%', duration: 0.5 });
            gsap.to('#scienceIndicator', { width: (100 - trustLevels.science) + '%', duration: 0.5 });
            gsap.to('#govIndicator', { width: (100 - trustLevels.gov) + '%', duration: 0.5 });
            gsap.to('#electionIndicator', { width: (100 - trustLevels.election) + '%', duration: 0.5 });
        }

        function resetTrust() {
            trustLevels.media = 87;
            trustLevels.science = 92;
            trustLevels.gov = 45;
            trustLevels.election = 72;
            updateTrustDisplay();
            document.getElementById('eventLog').innerHTML =
                '<div style="padding: 4px 0; border-bottom: 1px solid rgba(255,255,255,0.08);">Click "Inject Disinformation" to simulate false claim exposure</div>';
        }

        // ═══════════════════════════════════════════════════════════════
        // EXPERIMENT 6: SOURCE LAUNDERING FLOW
        // ═══════════════════════════════════════════════════════════════

        function initSankey() {
            const container = document.getElementById('sankeyContainer');
            const rect = container.getBoundingClientRect();
            const width = rect.width;
            const height = rect.height;

            const svg = d3.select('#sankeyDiagram')
                .attr('width', width)
                .attr('height', height);

            const sources = [
                { name: "Anonymous Forum", x: 50, y: 80, color: '#ef4444' },
                { name: "Fake News Site", x: 50, y: 160, color: '#ef4444' },
                { name: "Foreign State Media", x: 50, y: 240, color: '#f59e0b' },
                { name: "Fringe Podcast", x: 50, y: 320, color: '#ef4444' },
                { name: "Bot Network", x: 50, y: 400, color: '#f59e0b' }
            ];

            const amplifiers = [
                { name: "Influencer A", x: 300, y: 120, color: '#f59e0b' },
                { name: "Partisan Blog", x: 300, y: 220, color: '#f59e0b' },
                { name: "YouTube Channel", x: 300, y: 320, color: '#f59e0b' },
                { name: "Twitter Trending", x: 300, y: 420, color: '#06b6d4' }
            ];

            const mainstream = [
                { name: "Cable News Panel", x: 550, y: 150, color: '#06b6d4' },
                { name: "Print Article", x: 550, y: 270, color: '#3b82f6' },
                { name: "Wire Service", x: 550, y: 390, color: '#3b82f6' }
            ];

            const legitimized = [
                { name: "Major Network", x: 800, y: 200, color: '#3b82f6' },
                { name: "Policy Debate", x: 800, y: 350, color: '#10b981' }
            ];

            const connections = [
                { from: sources[0], to: amplifiers[0], strength: 2 },
                { from: sources[1], to: amplifiers[1], strength: 3 },
                { from: sources[1], to: amplifiers[2], strength: 2 },
                { from: sources[2], to: amplifiers[1], strength: 2 },
                { from: sources[3], to: amplifiers[2], strength: 3 },
                { from: sources[4], to: amplifiers[3], strength: 4 },
                { from: amplifiers[0], to: mainstream[0], strength: 2 },
                { from: amplifiers[1], to: mainstream[1], strength: 2 },
                { from: amplifiers[2], to: mainstream[0], strength: 2 },
                { from: amplifiers[3], to: mainstream[2], strength: 3 },
                { from: mainstream[0], to: legitimized[0], strength: 3 },
                { from: mainstream[1], to: legitimized[0], strength: 2 },
                { from: mainstream[2], to: legitimized[1], strength: 2 }
            ];

            // Draw paths
            connections.forEach(conn => {
                svg.append('path')
                    .attr('d', `M${conn.from.x + 120},${conn.from.y}
                               C${(conn.from.x + conn.to.x) / 2 + 60},${conn.from.y}
                                ${(conn.from.x + conn.to.x) / 2 + 60},${conn.to.y}
                                ${conn.to.x},${conn.to.y}`)
                    .attr('fill', 'none')
                    .attr('stroke', conn.from.color)
                    .attr('stroke-width', conn.strength * 2.5)
                    .attr('opacity', 0.4);
            });

            // Draw nodes
            [...sources, ...amplifiers, ...mainstream, ...legitimized].forEach(node => {
                const g = svg.append('g').attr('transform', `translate(${node.x}, ${node.y - 12})`);
                g.append('rect')
                    .attr('width', 115)
                    .attr('height', 24)
                    .attr('fill', node.color)
                    .attr('rx', 4);
                g.append('text')
                    .attr('x', 57)
                    .attr('y', 16)
                    .attr('text-anchor', 'middle')
                    .attr('fill', '#fff')
                    .attr('font-size', '9px')
                    .text(node.name);
            });

            // Labels
            svg.append('text').attr('x', 105).attr('y', 30).attr('fill', '#666').attr('font-size', '12px').text('ORIGIN');
            svg.append('text').attr('x', 320).attr('y', 30).attr('fill', '#666').attr('font-size', '12px').text('AMPLIFICATION');
            svg.append('text').attr('x', 560).attr('y', 30).attr('fill', '#666').attr('font-size', '12px').text('MAINSTREAM');
            svg.append('text').attr('x', 800).attr('y', 30).attr('fill', '#666').attr('font-size', '12px').text('LEGITIMIZED');
        }

        // ═══════════════════════════════════════════════════════════════
        // EXPERIMENT 7: WEB OF LIES FORCE GRAPH
        // ═══════════════════════════════════════════════════════════════

        function initWebOfLies() {
            const container = document.getElementById('webContainer');
            const rect = container.getBoundingClientRect();
            const width = rect.width;
            const height = rect.height;

            const svg = d3.select('#webOfLies')
                .attr('width', width)
                .attr('height', height);

            const nodes = [
                { id: "qanon", label: "QAnon", group: 1, size: 25 },
                { id: "deepstate", label: "Deep State", group: 1, size: 22 },
                { id: "nwo", label: "New World Order", group: 2, size: 24 },
                { id: "5g", label: "5G Dangers", group: 3, size: 20 },
                { id: "vaccine", label: "Vaccine Chips", group: 3, size: 22 },
                { id: "election", label: "Stolen Election", group: 1, size: 24 },
                { id: "chemtrails", label: "Chemtrails", group: 2, size: 16 },
                { id: "flatearth", label: "Flat Earth", group: 4, size: 14 },
                { id: "illuminati", label: "Illuminati", group: 2, size: 20 },
                { id: "pizzagate", label: "Pizzagate", group: 1, size: 18 },
                { id: "antivax", label: "Anti-Vax", group: 3, size: 22 },
                { id: "climate", label: "Climate Hoax", group: 4, size: 18 },
                { id: "soros", label: "Soros", group: 1, size: 17 },
                { id: "bigpharma", label: "Big Pharma", group: 3, size: 19 }
            ];

            const links = [
                { source: "qanon", target: "deepstate" },
                { source: "qanon", target: "pizzagate" },
                { source: "qanon", target: "election" },
                { source: "deepstate", target: "nwo" },
                { source: "deepstate", target: "soros" },
                { source: "nwo", target: "illuminati" },
                { source: "nwo", target: "vaccine" },
                { source: "5g", target: "vaccine" },
                { source: "vaccine", target: "antivax" },
                { source: "vaccine", target: "bigpharma" },
                { source: "antivax", target: "bigpharma" },
                { source: "illuminati", target: "nwo" },
                { source: "flatearth", target: "chemtrails" },
                { source: "chemtrails", target: "climate" },
                { source: "climate", target: "nwo" },
                { source: "soros", target: "election" }
            ];

            const colorScale = d3.scaleOrdinal()
                .domain([1, 2, 3, 4])
                .range(['#ef4444', '#f59e0b', '#06b6d4', '#10b981']);

            const simulation = d3.forceSimulation(nodes)
                .force('link', d3.forceLink(links).id(d => d.id).distance(80))
                .force('charge', d3.forceManyBody().strength(-200))
                .force('center', d3.forceCenter(width / 2, height / 2))
                .force('collision', d3.forceCollide().radius(d => d.size + 5));

            const link = svg.append('g')
                .selectAll('line')
                .data(links)
                .enter()
                .append('line')
                .attr('stroke', 'rgba(255,255,255,0.15)')
                .attr('stroke-width', 1);

            const node = svg.append('g')
                .selectAll('g')
                .data(nodes)
                .enter()
                .append('g')
                .call(d3.drag()
                    .on('start', (event, d) => {
                        if (!event.active) simulation.alphaTarget(0.3).restart();
                        d.fx = d.x; d.fy = d.y;
                    })
                    .on('drag', (event, d) => { d.fx = event.x; d.fy = event.y; })
                    .on('end', (event, d) => {
                        if (!event.active) simulation.alphaTarget(0);
                        d.fx = null; d.fy = null;
                    }));

            node.append('circle')
                .attr('r', d => d.size)
                .attr('fill', d => colorScale(d.group))
                .attr('fill-opacity', 0.3)
                .attr('stroke', d => colorScale(d.group))
                .attr('stroke-width', 2);

            node.append('text')
                .text(d => d.label)
                .attr('text-anchor', 'middle')
                .attr('dy', 4)
                .attr('fill', '#fff')
                .attr('font-size', '9px');

            simulation.on('tick', () => {
                link.attr('x1', d => d.source.x).attr('y1', d => d.source.y)
                    .attr('x2', d => d.target.x).attr('y2', d => d.target.y);
                node.attr('transform', d => `translate(${d.x}, ${d.y})`);
            });
        }

        // ═══════════════════════════════════════════════════════════════
        // INITIALIZE ALL ON LOAD
        // ═══════════════════════════════════════════════════════════════

        window.addEventListener('load', () => {
            initMutationTree();
            initEchoChamber();
            initBotNetwork();
            initSankey();
            initWebOfLies();

            // Auto-start viral spread
            setTimeout(startViralSpread, 500);
        });

        // Handle resize
        window.addEventListener('resize', () => {
            resizeCanvas(viralCanvas, document.getElementById('viralContainer'));
            resizeCanvas(echoCanvas, document.getElementById('echoContainer'));
            resizeCanvas(botCanvas, document.getElementById('botContainer'));
        });
    </script>
</body>
</html>
